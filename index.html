<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BOC USD/CNY Dashboard</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b1220" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <header class="topbar">
    <div class="title">
      <h1>BOC USD/CNY (As Published: RMB per 100 USD)</h1>
      <p id="subtitle">Official BOC published values • Auto-capture every 5 minutes • Lagos time</p>
    </div>

    <div class="topActions">
      <a id="bocLatestLink" class="linkBtn" target="_blank" rel="noreferrer">Open BOC Latest</a>
      <button id="btnRefresh">Refresh</button>
    </div>
  </header>

  <main class="container">

    <section class="controls card">
      <div class="row">
        <label>Year
          <select id="yearSelect"></select>
        </label>

        <label>Month
          <select id="monthSelect"></select>
        </label>

        <label>Rate Column (charts/avg)
          <select id="rateColumn">
            <option value="middle">Middle Rate</option>
            <option value="buying">Buying Rate</option>
            <option value="selling">Selling Rate</option>
            <option value="cashBuying">Cash Buying</option>
            <option value="cashSelling">Cash Selling</option>
          </select>
        </label>

        <label>USD Exposure (default 1.5B)
          <input id="usdExposure" type="number" value="1500000000" min="0" step="1000000">
        </label>

        <label>Baseline Rate (RMB per 100 USD)
          <input id="baselineRate" type="number" value="714.60" min="0" step="0.01">
        </label>

        <button id="btnLockBaseline" class="btnPrimary">Lock Baseline for this Month</button>
      </div>

      <div class="row">
        <label>Alert Threshold (USD Impact, in M)
          <input id="alertThresholdM" type="number" value="10" min="0" step="1">
        </label>

        <button id="btnDownloadCsv">Export CSV</button>
        <button id="btnDownloadJson" class="btnGhost">Export JSON</button>
        <button id="btnDownloadXls" class="btnPrimary">Export Excel</button>
        <button id="btnDownloadCaptureLog" class="btnGhost">Export Capture Log</button>

        <button id="btnRunNow" class="btnWarn">Run Now</button>

        <div class="emailBox">
          <input id="emailTo" placeholder="Enter email address" inputmode="email" />
          <button id="btnEmail">Email</button>
        </div>
      </div>

      <div class="hint">
        Logic: You enter USD exposure at baseline → baseline CNY obligation becomes fixed → dashboard shows extra USD required vs baseline (all in M).
      </div>
    </section>

    <section class="grid">

      <div class="card wide">
        <h2>Live Monitor — Last Updated (from Capture Log)</h2>
        <div class="row">
          <button id="btnLoadLive" class="btnPrimary">Load Live Status</button>
          <div style="flex:1"></div>
          <div class="hint">Capture log updates every run (every 5 mins)</div>
        </div>
        <div id="liveBox" class="impactBox"></div>
      </div>

      <div class="card wide">
        <h2>Baseline FX Impact Summary (USD, in Millions)</h2>
        <div id="impactBox" class="impactBox"></div>
      </div>

      <div class="card wide">
        <h2>FX P&amp;L Graph — USD Impact vs Baseline (Daily)</h2>
        <div class="chartWrap tall"><canvas id="pnlChart"></canvas></div>
        <div class="hint">Daily impact uses daily average Middle rate for that day.</div>
      </div>

      <div class="card wide">
        <h2>Intraday — Selected Day (Value + Running Avg)</h2>
        <div class="row">
          <label>Select Date
            <select id="daySelect"></select>
          </label>
          <button id="btnDrawIntraday">Draw Intraday</button>
          <div style="flex:1"></div>
          <div class="hint">Table below shows LAST 5 rows only (scrollable).</div>
        </div>

        <div class="chartWrap"><canvas id="intradayChart"></canvas></div>

        <div class="tableWrap scrollBox">
          <table id="intradayTable">
            <thead>
              <tr>
                <th>Publish Time</th>
                <th>Value (Selected)</th>
                <th>Running Avg</th>
                <th>% Change vs Prev</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="card wide">
        <h2>Tab 1 — Monthly Raw Records (All Published Events)</h2>
        <p class="hint">USD Impact (M) = extra USD required vs Baseline (uses Middle).</p>

        <div class="tableWrap scrollBoxLarge">
          <table id="rawTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Publish Time</th>
                <th>Buying</th>
                <th>Cash Buying</th>
                <th>Selling</th>
                <th>Cash Selling</th>
                <th>Middle</th>
                <th>USD Impact (M)</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <h2>Tab 2 — Daily Averages (Year)</h2>
        <div class="chartWrap"><canvas id="avgChart"></canvas></div>
        <div class="tableWrap">
          <table id="avgTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Avg (Selected)</th>
                <th>% Change vs Prev Day</th>
                <th>Min</th>
                <th>Max</th>
                <th>Publishes</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <h2>Tab 3 — Daily First Published (Year)</h2>
        <div class="chartWrap"><canvas id="firstChart"></canvas></div>
        <div class="tableWrap">
          <table id="firstTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>First Publish Time</th>
                <th>Value (Selected)</th>
                <th>% Change vs Prev Day</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="app.js"></script>
  <script>
    if ("serviceWorker" in navigator) navigator.serviceWorker.register("./sw.js");
  </script>
</body>
</html>
