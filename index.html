<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BOC USD/CNY Dashboard</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b1220" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <header class="topbar">
    <div class="title">
      <h1>BOC USD/CNY (As Published: RMB per 100 USD)</h1>
      <p id="subtitle">Auto-capture every 5 minutes • Mobile-ready • Lagos time</p>
    </div>

    <div class="topActions">
      <a id="bocLatestLink" class="linkBtn" target="_blank" rel="noreferrer">Open BOC Latest</a>
      <button id="btnRefresh">Refresh</button>
    </div>
  </header>

  <main class="container">
    <section class="controls card">
      <div class="row">
        <label>
          Year
          <select id="yearSelect"></select>
        </label>

        <label>
          Month
          <select id="monthSelect"></select>
        </label>

        <label>
          Rate Column (for charts/averages)
          <select id="rateColumn">
            <option value="middle">Middle Rate</option>
            <option value="buying">Buying Rate</option>
            <option value="selling">Selling Rate</option>
            <option value="cashBuying">Cash Buying</option>
            <option value="cashSelling">Cash Selling</option>
          </select>
        </label>
      </div>

      <div class="row">
        <button id="btnDownloadCsv">Export CSV</button>
        <button id="btnDownloadJson" class="btnGhost">Export JSON</button>
        <button id="btnDownloadXls" class="btnPrimary">Export Excel</button>

        <button id="btnRunNow" class="btnWarn">Run Now</button>

        <div class="emailBox">
          <input id="emailTo" placeholder="Enter email address" inputmode="email" />
          <button id="btnEmail">Email</button>
        </div>
      </div>

      <p class="hint">
        We capture the official BOC “latest published snapshot” multiple times per day and dedupe by Publish Time.
      </p>
    </section>

    <section class="grid">
      <div class="card wide">
        <h2>Tab 1 — Monthly Raw Records (All Captured Publish Events)</h2>
        <p class="hint">USD Impact column is based on Middle rate change vs previous publish event (using exposure below).</p>

        <div class="tableWrap">
          <table id="rawTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Publish Time</th>
                <th>Buying</th>
                <th>Cash Buying</th>
                <th>Selling</th>
                <th>Cash Selling</th>
                <th>Middle</th>
                <th>USD Impact</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <h2>Tab 2 — Daily Averages (Year)</h2>
        <div class="chartWrap"><canvas id="avgChart"></canvas></div>
        <div class="tableWrap">
          <table id="avgTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Avg (Selected)</th>
                <th>% Change vs Prev Day</th>
                <th>Min</th>
                <th>Max</th>
                <th>Publishes</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <h2>Tab 3 — Daily First Published (Year)</h2>
        <div class="chartWrap"><canvas id="firstChart"></canvas></div>
        <div class="tableWrap">
          <table id="firstTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>First Publish Time</th>
                <th>Value (Selected)</th>
                <th>% Change vs Prev Day</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="card wide">
        <h2>USD Impact (based on CNY exposure)</h2>
        <div class="row">
          <label>
            CNY Exposure (default 1.5B)
            <input id="cnyExposure" type="number" value="1500000000" min="0" step="1000000">
          </label>
          <button id="btnRecalcImpact">Recalculate</button>
        </div>

        <div id="impactBox" class="impactBox"></div>
      </div>
    </section>
  </main>

  <!-- If your office blocks CDN, charts will auto-disable gracefully -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <script src="app.js"></script>
  <script>
    if ("serviceWorker" in navigator) navigator.serviceWorker.register("./sw.js");
  </script>
</body>
</html>
